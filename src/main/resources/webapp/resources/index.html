<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title> Skills </title>
</head>

<body>

<h1>Destinations : </h1>
<ul id="list"></ul>
<div id="destinationList"></div>

<button onclick="next()">Next</button>
<button onclick="previous()">Previous</button>

<h1>Add new destination : </h1>
<form id="form" onsubmit="postData(event)">
    <input id="city" name="city" placeholder="City" type="text" required>
    <input id="country" name="country" placeholder="Country" type="text" required>
    <input id="description" name="description" placeholder="Description" type="text" required>
    <input id="targets" name="targets" placeholder="Targets" type="text" required>
    <input id="cost" name="cost" placeholder="Cost" type="number" required>

    <input type="submit" value="Submit">
</form>

<script>
startIndex = 0

var ul = document.getElementById("list");
document.getElementById("destinationList").appendChild(ul);
var li;

function clearChildren(){
    while (ul.lastElementChild) {
          ul.removeChild(ul.lastElementChild);
    }
}

function next() {
            var items;
            var url = '/api/next/'+startIndex

            clearChildren()

            fetch(url)
                         .then(res => res.json())
                         .then(json => {
                                items = json
                                items.forEach(function(dest){
                                    li = document.createElement('li')
                                    ul.appendChild(li)

                                    li.innerHTML += "<strong>City: </strong>" + dest.city + ", <strong> Country: </strong>" + dest.country;
                            })
                         })
                         .catch(function(error) {
                                console.log(error);
                         });
            startIndex = startIndex + 4
}

function previous() {
            var items;
            startIndex = startIndex - 4
            var url = 'api/previous/'+startIndex
            clearChildren()
            fetch(url)
                         .then(res => res.json())
                         .then(json => {
                                items = json
                                items.forEach(function(dest){
                                    li = document.createElement('li')
                                    ul.appendChild(li)

                                    li.innerHTML += "<strong>City: </strong>" + dest.city + ", <strong> Country: </strong>" + dest.country;
                            })
                         })
                         .catch(function(error) {
                                console.log(error);
                         });

}


function formDataToJson(formElement) {

	var $this = formElement
		, viewArr = $this.serializeArray()
		, view = {};

	for (var i in viewArr) {
		view[viewArr[i].name] = viewArr[i].value;
	}

  return view;
}

function postData(event) {
    event.preventDefault();
    const form = document.getElementById('form');
    let rawData = new FormData(form);

    let data = {};
    for(let pair of rawData.entries()) {
     data[pair[0]] = pair[1];
    }
    var targetList = data.targets.split(",");
    data.targets = targetList
    let contactData = JSON.stringify(data);

    fetch('/api/destination', {method: 'POST', body: contactData,  headers: {
            'Content-Type': 'application/json'}}
            )
}





</script>


</body>
</html>